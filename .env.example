# FlowLens Environment Configuration
# Copy this file to .env and adjust values as needed

# =============================================================================
# Application Settings
# =============================================================================
APP_NAME=FlowLens
APP_VERSION=0.1.0
ENVIRONMENT=development  # development, staging, production
DEBUG=true

# =============================================================================
# PostgreSQL Database
# =============================================================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=flowlens
POSTGRES_PASSWORD=flowlens
POSTGRES_DATABASE=flowlens

# Connection pool settings
POSTGRES_POOL_SIZE=20
POSTGRES_MAX_OVERFLOW=10
POSTGRES_POOL_TIMEOUT=30
POSTGRES_POOL_RECYCLE=1800

# =============================================================================
# Redis (Optional - enable for >10k flows/sec or >20 concurrent users)
# =============================================================================
REDIS_ENABLED=false
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DATABASE=0
REDIS_SSL=false
REDIS_POOL_SIZE=10

# =============================================================================
# Kafka (Optional - enable for >10k flows/sec)
# =============================================================================
KAFKA_ENABLED=false
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_TOPIC_FLOWS=flowlens.flows.raw
KAFKA_TOPIC_ENRICHED=flowlens.flows.enriched
KAFKA_CONSUMER_GROUP=flowlens
KAFKA_COMPRESSION=lz4

# =============================================================================
# Flow Ingestion Service
# =============================================================================
INGESTION_BIND_ADDRESS=0.0.0.0
INGESTION_NETFLOW_PORT=2055
INGESTION_SFLOW_PORT=6343

# Batching
INGESTION_BATCH_SIZE=1000
INGESTION_BATCH_TIMEOUT_MS=1000

# Backpressure thresholds
INGESTION_QUEUE_MAX_SIZE=100000
INGESTION_SAMPLE_THRESHOLD=50000
INGESTION_DROP_THRESHOLD=80000
INGESTION_SAMPLE_RATE=10

# =============================================================================
# Enrichment Service
# =============================================================================
ENRICHMENT_BATCH_SIZE=500
ENRICHMENT_POLL_INTERVAL_MS=100
ENRICHMENT_WORKER_COUNT=4

# DNS resolver
ENRICHMENT_DNS_TIMEOUT=2.0
ENRICHMENT_DNS_CACHE_TTL=3600
ENRICHMENT_DNS_CACHE_SIZE=10000
# ENRICHMENT_DNS_SERVERS=8.8.8.8,8.8.4.4  # Uncomment to use custom DNS

# GeoIP database (download from MaxMind)
# ENRICHMENT_GEOIP_DATABASE_PATH=/path/to/GeoLite2-City.mmdb

# =============================================================================
# Dependency Resolution Service
# =============================================================================
RESOLUTION_WINDOW_SIZE_MINUTES=5
RESOLUTION_BATCH_SIZE=1000
RESOLUTION_POLL_INTERVAL_MS=500
RESOLUTION_STALE_THRESHOLD_HOURS=24

# External IP filtering - exclude external IPs from dependency mapping
# Set to true to exclude all dependencies involving external (non-private) IPs
RESOLUTION_EXCLUDE_EXTERNAL_IPS=false
# Set to true to exclude only dependencies where the SOURCE is external
RESOLUTION_EXCLUDE_EXTERNAL_SOURCES=false
# Set to true to exclude only dependencies where the TARGET is external
RESOLUTION_EXCLUDE_EXTERNAL_TARGETS=false

# =============================================================================
# API Service
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false  # Enable for development

# CORS
API_CORS_ORIGINS=*

# Rate limiting
API_RATE_LIMIT_REQUESTS=100
API_RATE_LIMIT_WINDOW_SECONDS=60

# Pagination
API_DEFAULT_PAGE_SIZE=50
API_MAX_PAGE_SIZE=1000

# =============================================================================
# Authentication
# =============================================================================
AUTH_ENABLED=true
AUTH_SECRET_KEY=change-me-in-production  # IMPORTANT: Generate a strong secret
AUTH_ALGORITHM=HS256
AUTH_ACCESS_TOKEN_EXPIRE_MINUTES=30
AUTH_REFRESH_TOKEN_EXPIRE_DAYS=7

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json, console
LOG_INCLUDE_TIMESTAMP=true
LOG_INCLUDE_CALLER=true
